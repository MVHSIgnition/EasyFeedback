<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">
    <title>EZFeedback</title>

    <!-- Bootstrap core CSS -->
    <link href="../../dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="../../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="jumbotron-narrow.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="../../assets/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
<body>
	<div class="container">
      <div class="header clearfix">
        <nav>
        </nav>
        <h3 class="text-muted"><input style="height:100px;width:100px" type = "image" src = "logo.png" onclick = "location.href = 'index.html';"></input></h3>
      </div>

      <!--<div class="jumbotron">-->
	  <!--start your code-->
        <h1 id="question" style ="visibility:hidden"></h1>
		<h1 id="data" style="visibility:hidden">Data</h1>
<<<<<<< HEAD
		<button id="btn" class="btn btn-primary" style="visibility:visible">Publish Next Question</button>
		
		<div id="all" class="span6" style="visibility:hidden">
=======
		<button id="btn" class="btn btn-primary" style="visibility:visible" onclick="startPoll()">Publish Next Question</button>

		<p id="a" style="visibility:hidden">a: 0</p>
		<p id="b" style="visibility:hidden">b: 0</p>
		<p id="c" style="visibility:hidden">c: 0</p>
		<p id="d" style="visibility:hidden">d: 0</p>

		<div id="all" style="visibility:hidden">
>>>>>>> origin/master
		  <h1 id="question" style="visibility:hidden;"></h1>
		  <h1 id="data" style="visibility:hidden">Data</h1>
		  <!--<button id="btn" onclick="startPoll()">Publish Next Question</button>-->

		  <strong id="a">A: 0</strong><span class="pull-right" id="AP">0%</span>
		  <div class="progress progress-danger active">
			  <div id="aBar" class="bar" style="width: 0%;"></div>
		  </div>
		  <strong id="b">B: 0</strong><span class="pull-right" id="BP">0%</span>
		  <div class="progress progress-info active">
			  <div id="bBar" class="bar" style="width: 0%;"></div>
		  </div>
		  <strong id="c">C: 0</strong><span class="pull-right" id="CP">0%</span>
		  <div class="progress progress-success active">
			  <div id="cBar" class="bar" style="width: 0%;"></div>
		  </div>
		  <strong id="d">D: 0</strong><span class="pull-right" id="DP">0%</span>
		  <div class="progress progress-warning active">
			  <div id="dBar" class="bar" style="width: 10%;"></div>
		  </div>
		</div>
<<<<<<< HEAD
		
		
		
		<button id="reset" class="btn"  style="visibility:hidden">Stop Polling</button>
=======

		<button id="reset" class="btn" onclick="resetAll()" style="visibility:hidden">Stop Polling</button>
>>>>>>> origin/master
		<!--end your code-->
      <!--</div>-->

    </div> <!-- /container -->


</body>


<script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.4.3.js"></script>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script>

var c_channel = 't_handler', o_channel = 's_handler';
var total = 0;

var anum = 0, bnum = 0, cnum =0, dnum = 0;
var stopvar = false;
var pubnub;

function startPoll(){
	var a = $('#a'), b = $('#b'), c = $('#c'), d = $('#d'), button = $('#btn'),button2 = $('#reset'), data = $('#data');
	var all = $('#all');
	var AP = $('#AP'), BP = $('#BP'), CP = $('#CP'), DP = $('#DP');
	var aBar = $("#aBar"), bBar = $("#bBar"), cBar = $("#cBar"), dBar = $("#dBar");
	var qhtml = $('#question');
	qhtml.css("visibility:visible;");
	/*a.style.visibility = "visible";
	b.style.visibility = "visible";
	c.style.visibility = "visible";
	d.style.visibility = "visible";*/
	all.css("visibility:visible;")
	button.css("visibility:hidden;")
	button2.css("visibility:visible;")
	
	pubnub.addListener({
    
    message: function(payload) {
		var message = payload.message;
	
		console.log(message);
		if(message[0] === 1){
				console.log(message);
				if(message[1] === 1){
					anum += 1;
					a.innerHTML = "A: "+anum;
					console.log(anum);
					
				}
				else if(message[1] == 2){
					bnum += 1;
					b.innerHTML = "B: "+bnum;
					console.log(bnum);
					
				}
				else if(message[1] == 3){
					cnum += 1;
					c.innerHTML = "C: "+cnum;
					console.log(cnum);
					
				}
				else if(message[1] == 4){
					dnum += 1;
					d.innerHTML = "D: "+dnum;
					console.log(dnum);
					
				}
				total = anum+bnum+cnum+dnum;
				DP.innerHTML = Math.round(dnum/total) * 100 + "%";
				dBar.style.width = Math.round(dnum/total) * 100 + "%";
				console.log(dBar.style.width);
				CP.innerHTML = Math.round(cnum/total) * 100 + "%";
				cBar.style.width = Math.round(cnum/total) * 100 + "%";
				BP.innerHTML = Math.round(bnum/total) * 100 + "%";
				bBar.style.width = Math.round(bnum/total) * 100 + "%";
				AP.innerHTML = Math.round(anum/total) * 100 + "%";
				aBar.style.width = Math.round(anum/total) * 100 + "%";
				

			}
			else if(message[0] === 0){
				console.log(message);
				qhtml.innerHTML = message[1];
				console.log(message[1]);
			}
			else if(message[0] == 4){
				stopvar = true;
			}
    },
    presence: function(p) {
    },
    status: function(s) {
        // handle status
    }
	})
	
	pubnub.subscribe({
		channels: [c_channel, o_channel],
	});
	
	
	pubnub.publish({
			channel : o_channel, message : [0]
		})
	}
function resetAll(){
	publish({
        channel : o_channel, message : [3,qhtml.value,[anum,bnum,cnum,dnum]]
    })
	total = 0;
	anum = 0, bnum = 0, cnum =0, dnum = 0;
	if(stopvar == false){
		qhtml.style.visibility = "hidden";
		all.style.visibility = "hidden";
		//a.style.visibility = "hidden";
		a.innerHTML = "A: 0";
		AP.innerHTML = "0%";
		//b.style.visibility = "hidden";
		b.innerHTML = "B: 0";
		BP.innerHTML = "0%";
		//c.style.visibility = "hidden";
		c.innerHTML = "C: 0";
		CP.innerHTML = "0%";
		//d.style.visibility = "hidden";
		d.innerHTML = "D: 0";
		DP.innerHTML = "0%";
		button.style.visibility = "visible";
		button2.style.visibility = "hidden";
	}else{
		qhtml.style.visibility = "hidden";
		a.style.visibility = "hidden";
		a.innerHTML = "a: 0";
		AP.innerHTML = "0%";
		b.style.visibility = "hidden";
		b.innerHTML = "b: 0";
		BP.innerHTML = "0%";
		c.style.visibility = "hidden";
		c.innerHTML = "c: 0";
		CP.innerHTML = "0%";
		d.style.visibility = "hidden";
		d.innerHTML = "d: 0";
		DP.innerHTML = "0%";
		button.style.visibility = "hidden";
		button2.style.visibility = "hidden";
		data.style.visibility = "visible";
	}
}

$(document).ready(function() {
  pubnub = new PubNub({
	publish_key:'pub-c-afbd56e9-6341-4a07-b493-cbb3ebf25284',
	subscribe_key:'sub-c-d785fd74-f08e-11e6-9283-02ee2ddab7fe',
	ssl:true
	});

$('#reset').click(resetAll);
$('#btn').click(startPoll);
})

</script>
<script>
</script>
</html>

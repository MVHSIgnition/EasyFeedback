<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">
    <title>EZFeedback</title>

    <!-- Bootstrap core CSS -->
    <link href="../../dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="../../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="jumbotron-narrow.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="../../assets/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
<body>
	<div class="container">
      <div class="header clearfix">
        <nav>
        </nav>
        <h3 class="text-muted">EZFeedback</h3>
      </div>

      <div class="jumbotron">
	  <!--start your code-->
        <h1 id="question" style ="visibility:hidden"></h1>
		<h1 id="data" style="visibility:hidden">Data</h1>
		<button id="btn" onclick="startPoll()">Publish Next Question</button>

		<p id="a" style="visibility:hidden">a: 0</p>
		<p id="b" style="visibility:hidden">b: 0</p>
		<p id="c" style="visibility:hidden">c: 0</p>
		<p id="d" style="visibility:hidden">d: 0</p>
		
		<div id="all" style="visibility:hidden">
		  <h1 id="question" style="visibility:hidden;"></h1>
		  <h1 id="data" style="visibility:hidden">Data</h1>
		  <button id="btn" onclick="startPoll()">Publish Next Question</button>
		  
		  <strong id="a">A: 0</strong><span class="pull-right" id="AP">0%</span>
		  <div class="progress progress-danger active">
			  <div class="bar" style="width: 0%;"></div>
		  </div>
		  <strong id="b">B: 0</strong><span class="pull-right" id="BP">0%</span>
		  <div class="progress progress-info active">
			  <div class="bar" style="width: 0%;"></div>
		  </div>
		  <strong id="c">C: 0</strong><span class="pull-right" id="CP">0%</span>
		  <div class="progress progress-success active">
			  <div class="bar" style="width: 0%;"></div>
		  </div>
		  <strong id="d">D: 0</strong><span class="pull-right" id="DP">0%</span>
		  <div class="progress progress-warning active">
			  <div class="bar" style="width: 0%;"></div>
		  </div>
		</div>
		
		<button id="reset" onclick="resetAll()" style="visibility:hidden">Stop Polling</button>
		<!--end your code-->
      </div>

    </div> <!-- /container -->


</body>


<script src=http://cdn.pubnub.com/pubnub.min.js></script>
<script>
var qhtml = PUBNUB.$('question');
var anum = 0, bnum = 0, cnum =0, dnum = 0;
var stopvar = false;
var pubnub = PUBNUB.init({publish_key:'pub-c-afbd56e9-6341-4a07-b493-cbb3ebf25284',subscribe_key:'sub-c-d785fd74-f08e-11e6-9283-02ee2ddab7fe',ssl:true});
var a = PUBNUB.$('a'), b = PUBNUB.$('b'), c = PUBNUB.$('c'), d = PUBNUB.$('d'), button = PUBNUB.$('btn'),button2 = PUBNUB.$('reset'), data = PUBNUB.$('data');
var all = PUBNUB.$('all');
var AP = PUBNUB.$('AP'), BP = PUBNUB.$('BP'), CP = PUBNUB.$('CP'), DP = PUBNUB.$('DP');
function startPoll(){
	qhtml.style.visibility = "visible";
	/*a.style.visibility = "visible";
	b.style.visibility = "visible";
	c.style.visibility = "visible";
	d.style.visibility = "visible";*/
	all.style.visibility = "visible"
	button.style.visibility = "hidden";
	button2.style.visibility = "visible";


	var channels = ['t_handler','s_handler'];
	pubnub.subscribe({
		channel  : channels,
		callback : function(message) { 
			if(message[0] === 1){
				var total = anum+bnum+cnum+dnum;
				if(message[1] === 0){
					anum += 1;
					a.innerHTML = "A: "+anum;
					AP.innerHTML = Math.round(anum/total) + "%";
				}
				else if(message[1] == 1){
					bnum += 1;
					b.innerHTML = "B: "+bnum;
					BP.innerHTML = Math.round(bnum/total) + "%";
				}
				else if(message[1] == 2){
					cnum += 1;
					c.innerHTML = "C: "+cnum;
					CP.innerHTML = Math.round(cnum/total) + "%";
				}
				else if(message[1] == 3){
					dnum += 1;
					d.innerHTML = "D: "+dnum;
					DP.innerHTML = Math.round(dnum/total) + "%";
				}
				
			}
			else if(message[0] === 0){
				console.log("hootis");
				qhtml.innerHTML = message[1];
			}
			else if(message[0] == 4){
				console.log("xd");
				stopvar = true;
			}
		}
	});
	pubnub.publish({
			channel : "s_handler", message : [0]
		})

	}
function resetAll(){
	pubnub.publish({
        channel : "s_handler", message : [3,qhtml.value,[anum,bnum,cnum,dnum]]
    })
	anum = 0, bnum = 0, cnum =0, dnum = 0;
	if(stopvar == false){
		qhtml.style.visibility = "hidden";
		all.style.visibility = "hidden";
		//a.style.visibility = "hidden";
		a.innerHTML = "A: 0";
		//b.style.visibility = "hidden";
		b.innerHTML = "B: 0";
		//c.style.visibility = "hidden";
		c.innerHTML = "C: 0";
		//d.style.visibility = "hidden";
		d.innerHTML = "D: 0";
		button.style.visibility = "visible";
		button2.style.visibility = "hidden";
	}else{
		qhtml.style.visibility = "hidden";
		a.style.visibility = "hidden";
		a.innerHTML = "a: 0";
		b.style.visibility = "hidden";
		b.innerHTML = "b: 0";
		c.style.visibility = "hidden";
		c.innerHTML = "c: 0";
		d.style.visibility = "hidden";
		d.innerHTML = "d: 0";
		button.style.visibility = "hidden";
		button2.style.visibility = "hidden";
		data.style.visibility = "visible";
	}
}</script>
<script>

</script>
</html>

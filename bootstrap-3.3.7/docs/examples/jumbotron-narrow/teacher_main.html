<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">
    <title>EZFeedback</title>

    <!-- Bootstrap core CSS -->
    <link href="../../dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="../../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="jumbotron-narrow.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="../../assets/js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
<body>
	<div class="container">
      <div class="header clearfix">
        <nav>
        </nav>
        <h3 class="text-muted"><input style="height:100px;width:150px" type = "image" src = "img/logo.png" onclick = "location.href = 'index.html';"></input></h3>
      </div>

      <!--<div class="jumbotron">-->
	  <!--start your code-->
        <h1 id="question" style ="visibility:hidden"></h1>
		<h1 id="data" style="visibility:hidden">Data</h1>

		<button id="btn" class="btn btn-primary" style="visibility:visible" onclick="startPoll()">Publish Next Question</button>
		
		<div id="all" class="span6" style="visibility:hidden">

		  <h1 id="question" style="visibility:hidden;"></h1>
		  <h1 id="data" style="visibility:hidden">Data</h1>

		  <strong id="a">A: 0</strong>
		  <div class="progress">
          <div id="aBar"class="progress-bar" role="progressbar" aria-valuenow="0"
          aria-valuemin="0" aria-valuemax="100" style="width:0%">
            <span class="sr-only" id="AP">0%</span>
          </div>
		  </div>
		  <strong id="b">B: 0</strong>
		  <div class="progress">
          <div id="bBar" class="progress-bar" role="progressbar" aria-valuenow="0"
          aria-valuemin="0" aria-valuemax="100" style="width:0%">
            <span class="sr-only" id="BP">0%</span>
          </div>
		  </div>
		  <strong id="c">C: 0</strong>
		  <div class="progress">
          <div id="cBar" class="progress-bar" role="progressbar" aria-valuenow="0"
          aria-valuemin="0" aria-valuemax="100" style="width:0%">
            <span class="sr-only" id="CP">0%</span>
          </div>
		  </div>
		  <strong id="d">D: 0</strong>
		  <div class="progress">
          <div id="dBar" class="progress-bar" role="progressbar" aria-valuenow="0"
          aria-valuemin="0" aria-valuemax="100" style="width:0%">
            <span class="sr-only" id="DP">0%</span>
          </div>
		  </div>

		</div>
		
		<div id="feedback">
			<h1>FEEDBACK</h1>
				<strong id="bo">Boring</strong>
			<div class="progress">
			  <div id="bore" class="progress-bar" role="progressbar" aria-valuenow="0"
			  aria-valuemin="0" aria-valuemax="100" style="width:0%">
				<span class="sr-only" id="BP">0%</span>
			  </div>
			  </div>
			  <strong id="ba">Bad</strong>
			  <div class="progress">
			  <div id="bad" class="progress-bar" role="progressbar" aria-valuenow="0"
			  aria-valuemin="0" aria-valuemax="100" style="width:0%">
				<span class="sr-only" id="CP">0%</span>
			  </div>
			  </div>
			  <strong id="g">Good</strong>
			  <div class="progress">
			  <div id="good" class="progress-bar" role="progressbar" aria-valuenow="0"
			  aria-valuemin="0" aria-valuemax="100" style="width:0%">
				<span class="sr-only" id="DP">0%</span>
					  </div>
			  </div>
		</div>
	</div>

</body>


<script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.4.3.js"></script>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script>

var t_channel = 't_handler', s_channel = 's_handler';
var total = 0;

var anum = 0, bnum = 0, cnum =0, dnum = 0;
var stopvar = false;

var a = $('#a'), b = $('#b'), c = $('#c'), d = $('#d'), button = $('#btn'),button2 = $('#reset'), data = $('#data');
var all = $('#all');
var AP = $('#AP'), BP = $('#BP'), CP = $('#CP'), DP = $('#DP');
var aBar = $("#aBar"), bBar = $("#bBar"), cBar = $("#cBar"), dBar = $("#dBar");
var qhtml = $('#question');
var good = $("#good"), bad = $("#bad"), bore = $("#bore");
var borenum = 0, goodnum = 0, badnum = 0;
var totemot;

var pubnub = new PubNub({
	publish_key:'pub-c-18f40226-157c-4c75-b3a8-95302621baaf',
	subscribe_key:'sub-c-f005c270-f6f7-11e6-b0ac-0619f8945a4f',
	ssl:true
	});
	
pubnub.subscribe({
		channel: t_channel
	});

	
pubnub.addListener({
	
	message: function(payload) {
		var message = payload.message;
	
		console.log(message);
		if(message[0] === 1){
				console.log(message);
				if(message[1] === 1){
					anum += 1;
					a.html("A: "+anum);
					console.log(anum);
					
				}
				else if(message[1] == 2){
					bnum += 1;
					b.html("B: "+bnum);
					console.log(bnum);
					
				}
				else if(message[1] == 3){
					cnum += 1;
					c.html("C: "+cnum);
					console.log(cnum);
					
				}
				else if(message[1] == 4){
					dnum += 1;
					d.html("D: "+dnum);
					console.log(dnum);
					
				}
				total = anum+bnum+cnum+dnum;
				 
				//DP.innerHTML = Math.round(dnum/total * 100) + "%";
				//dBar.style.width = Math.round(dnum/total) * 100 + "%";
				dBar.css("width", Math.round(dnum/total * 100) + "%");
				//CP.innerHTML = Math.round(cnum/total * 100) + "%";
				cBar.css("width", Math.round(cnum/total * 100) + "%");
				//cBar.style.width = Math.round(cnum/total) * 100 + "%";
				//BP.innerHTML = Math.round(bnum/total * 100) + "%";
				bBar.css("width", Math.round(bnum/total * 100) + "%");
				//bBar.style.width = Math.round(bnum/total) * 100 + "%";
				//AP.innerHTML = Math.round(anum/total * 100) + "%";
				aBar.css("width", Math.round(anum/total * 100) + "%");
				//aBar.style.width = Math.round(anum/total) * 100 + "%";
				

			}
			else if(message[0] === 0){
				console.log(message);
				qhtml.html(message[1]);
				console.log(message[1]);
			}
			else if(message[0] == 4){
				stopvar = true;
			} 
			else if(message[0] == 6){
			console.log("emots");
				if (message[1] == 1) {
					borenum+= 1;
				}else if (message[1] == 2) {
					badnum+= 1;
				} else if (message[1] == 3) {
					goodnum+= 1;
				}
				
				
				totemot = borenum+goodnum+badnum;
				bore.css("width", Math.round(borenum/totemot * 100) + "%");
				good.css("width", Math.round(goodnum/totemot * 100) + "%");
				bad.css("width", Math.round(badnum/totemot * 100) + "%");
			}
	},
	presence: function(p) {
	},
	status: function(s) {
		// handle status
	}
});

function startPoll(){
	qhtml.css("visibility","visible");
	all.css("visibility","visible");
	button.attr("class","btn");
	button.attr("onclick","resetAll()");
	button.html("Stop Polling");
	
	pubnub.publish({
			channel : t_channel, 
			message : {
				room : roomcode,
				action : "retrieve" //retrieve next question (publishes to student inside the handler)
			}
		});
	}
function resetAll(){
	/*pubnub.publish({
		channel : t_channel, message : [3,qhtml.value,[anum,bnum,cnum,dnum]]
	})*/
	total = 0;
	anum = 0, bnum = 0, cnum =0, dnum = 0;
	if(stopvar == false){
		qhtml.css("visibility","hidden");
		all.css("visibility","hidden");
		a.html("A: 0");
		b.html("B: 0");
		c.html("C: 0");
		d.html("D: 0");
		button.attr("class","btn btn-primary");
		button.attr("onclick","startPoll()");
		button.html("Publish Next Question");
		aBar.css("width", "0%");
		bBar.css("width", "0%");
		cBar.css("width", "0%");
		dBar.css("width", "0%");
	}else{
		qhtml.style.visibility = "hidden";
		a.style.visibility = "hidden";
		a.innerHTML = "a: 0";
		AP.innerHTML = "0%";
		b.style.visibility = "hidden";
		b.innerHTML = "b: 0";
		BP.innerHTML = "0%";
		c.style.visibility = "hidden";
		c.innerHTML = "c: 0";
		CP.innerHTML = "0%";
		d.style.visibility = "hidden";
		d.innerHTML = "d: 0";
		DP.innerHTML = "0%";
		button.css("visibility","hidden");
		button2.css("visibility","hidden");
		data.style.visibility = "visible";
	}
}
</script>
</html>
